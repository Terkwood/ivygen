environment:

  matrix:
    - name: win32
      platform: amd64_x86
      qt: 5.5\msvc2013
      suffix: msvc2013

    - name: win64
      platform: amd64
      qt: 5.5\msvc2013_64
      suffix: msvc2013

    - name: win32
      plaftorm: mingw
      qt: 5.5\mingw492_32
      suffix: mingw

init:
  - set PATH=C:\Qt\%qt%\bin;%PATH%
  - set ORIGPATH=%PATH%
  - if not %platform%==mingw call "C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat" %platform%
  - if not %platform%==mingw (set makefiles="NMake Makefiles") else (set makefiles="MinGW Makefiles")

clone_folder: c:\dev\ivygen

before_build:
  - cd c:\dev\ivygen
  - md build-release
  - md build-debug

build_script:
  - if %platform%==mingw set PATH=C:\Qt\%qt%\bin;C:\Qt\Tools\mingw492_32\bin;C:\Program Files (x86)\CMake\bin
  - cd build-release
  - cmake .. -G %makefiles% -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="c:/dev/install"
  - if not %platform%==mingw (nmake) else (mingw32-make)
  - if not %platform%==mingw (nmake install) else (mingw32-make install)
  - cd ..
  - cd build-debug
  - cmake .. -G %makefiles% -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX="c:/dev/install"
  - if not %platform%==mingw (nmake) else (mingw32-make)
  - if not %platform%==mingw (nmake install) else (mingw32-make install)
  - if %platform%==mingw set PATH=%ORIGPATH%

after_build:
  - cd c:\dev\install
  - set buildname=%vlcqt_version%_build%APPVEYOR_BUILD_NUMBER%_%APPVEYOR_REPO_COMMIT:~0,7%
  - 7z a ..\ivygen\ivygen_%buildname%_%name%_%suffix%.7z bin lib data textures
  - cd c:\dev\ivygen
  
artifacts:
  - path: '*.7z'